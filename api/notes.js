import db from '../lib/db.js'; import { requireAuth } from './_auth.js'; export default async function handler(req,res){ const user=requireAuth(req,res); if(!user) return res.status(401).end(); if(req.method==='POST'){ const {text}=req.body||{}; if(!text) return res.status(400).json({error:'texto obrigat√≥rio'}); await db.query('insert into notes(user_id,text) values ($1,$2)',[user.sub,text]); return res.json({ok:true}); } if(req.method==='GET'){ const q=await db.query('select id,text,created_at from notes where user_id=$1 order by created_at desc limit 50',[user.sub]); return res.json(q.rows); } return res.status(405).end(); }